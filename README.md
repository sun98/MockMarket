# Mock Market Project

## 1. Requirements:

- `cmake>=3.22`, earlier versions are not guaranteed to work expectedly.

## 2. Usage

Go to the project's root directory.

- Compilation:
```
# check the `x` access of `build.sh`

./build.sh
```

- Running:
```
./build/MockMarket
```

- Configurable options:

  - In `main.cpp`, the construction parameters of `Client client` can be changed. The first two parameters are source file of insert order csv and cancel order csv. The third parameter controls whether the detailed trades generated by any insert order will be printed.
  - In `main.cpp`, the final status of the market are showed by `market.showStatus()`. This receives an enum parameter. `STATUS_MIN` means only print statistical information of the final market. `STATUS_FULL` will also print all the remaining orders in the limit order books.

## 3. Design

### 3.1 Market

#### Limit Order Book
In this project, the limit order book is implements as two `multi_map`s in `class Market`. One `multi_map` is used to store remaining ask orders and the other is for bid orders. The key of the `multi_map` is the price of the corresponding order while the value is the reference of the inserting orders. Since the items in `multi_map` is ordered, find the best matching orders for ask / bid orders can be very fast.

#### Order Cancellation
To support order cancellation, there has to be an efficient way to delete orders in the two `multi_map`s. Here an `unordered_map` is used to find quickly find the order. The key is `order_id` and the value if the reference of the inserting orders.

- Use the original `order_id` in the cancel order to find the reference of the original order's reference (within $O(1)$ time).
- Then use the price of the original order to quickly find the range of the original order in the corresponding book (within $O(\log(n))$ time). 
- Finally, iterate over the range and find the order that has the same `order_id` to erase.

### 3.2 Client

The client is bound to a data feeding backend to fetch incoming orders. To simplify the data processing, the data feeder is designed to store the file contents as vectors of order objects. This means that all the orders in the data feeder is loaded at the beginning although they are event triggered in a real environment.

In the meantime, the communication between client and market (server) is designed in the same thread. In a real world market, the client is not running in the same host with market. So in that time proper RPC approaches should be implemented to communicate market and clients.

### 3.3 Other Classes design
    
The class design of `Order` and `Trade` is simple and straight-forward. They are data classes. You can just read the header files.
